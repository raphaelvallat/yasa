<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>yasa.spindles_detect &#8212; yasa 0.6.2 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/yasa_128x128.png"></span>
          yasa</a>
        <span class="navbar-text navbar-version pull-left"><b>0.6.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../quickstart.html">Quickstart</a></li>
                <li><a href="../faq.html">FAQ</a></li>
                <li><a href="../changelog.html">What's new</a></li>
                <li><a href="../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="yasa-spindles-detect">
<h1>yasa.spindles_detect<a class="headerlink" href="#yasa-spindles-detect" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="yasa.spindles_detect">
<code class="sig-prename descclassname">yasa.</code><code class="sig-name descname">spindles_detect</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">sf</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ch_names</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">hypno</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">include</span><span class="o">=</span><span class="default_value">1, 2, 3</span></em>, <em class="sig-param"><span class="n">freq_sp</span><span class="o">=</span><span class="default_value">12, 15</span></em>, <em class="sig-param"><span class="n">freq_broad</span><span class="o">=</span><span class="default_value">1, 30</span></em>, <em class="sig-param"><span class="n">duration</span><span class="o">=</span><span class="default_value">0.5, 2</span></em>, <em class="sig-param"><span class="n">min_distance</span><span class="o">=</span><span class="default_value">500</span></em>, <em class="sig-param"><span class="n">thresh</span><span class="o">=</span><span class="default_value">{'corr': 0.65, 'rel_pow': 0.2, 'rms': 1.5}</span></em>, <em class="sig-param"><span class="n">multi_only</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">remove_outliers</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/yasa/detection.html#spindles_detect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#yasa.spindles_detect" title="Permalink to this definition">¶</a></dt>
<dd><p>Spindles detection.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>data</strong><span class="classifier">array_like</span></dt><dd><p>Single or multi-channel data. Unit must be uV and shape (n_samples) or
(n_chan, n_samples). Can also be a <a class="reference external" href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw" title="(in MNE v1.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.io.BaseRaw</span></code></a>,
in which case <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">sf</span></code>, and <code class="docutils literal notranslate"><span class="pre">ch_names</span></code> will be automatically
extracted, and <code class="docutils literal notranslate"><span class="pre">data</span></code> will also be automatically converted from
Volts (MNE) to micro-Volts (YASA).</p>
</dd>
<dt><strong>sf</strong><span class="classifier">float</span></dt><dd><p>Sampling frequency of the data in Hz.
Can be omitted if <code class="docutils literal notranslate"><span class="pre">data</span></code> is a <a class="reference external" href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw" title="(in MNE v1.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.io.BaseRaw</span></code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the detection is taking too long, make sure to downsample
your data to 100 Hz (or 128 Hz). For more details, please refer to
<a class="reference external" href="https://mne.tools/stable/generated/mne.filter.resample.html#mne.filter.resample" title="(in MNE v1.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.resample()</span></code></a>.</p>
</div>
</dd>
<dt><strong>ch_names</strong><span class="classifier">list of str</span></dt><dd><p>Channel names. Can be omitted if <code class="docutils literal notranslate"><span class="pre">data</span></code> is a
<a class="reference external" href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw" title="(in MNE v1.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.io.BaseRaw</span></code></a>.</p>
</dd>
<dt><strong>hypno</strong><span class="classifier">array_like</span></dt><dd><p>Sleep stage (hypnogram). If the hypnogram is loaded, the
detection will only be applied to the value defined in
<code class="docutils literal notranslate"><span class="pre">include</span></code> (default = N1 + N2 + N3 sleep).</p>
<p>The hypnogram must have the same number of samples as <code class="docutils literal notranslate"><span class="pre">data</span></code>.
To upsample your hypnogram, please refer to
<a class="reference internal" href="yasa.hypno_upsample_to_data.html#yasa.hypno_upsample_to_data" title="yasa.hypno_upsample_to_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">yasa.hypno_upsample_to_data()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default hypnogram format in YASA is a 1D integer
vector where:</p>
<ul class="simple">
<li><p>-2 = Unscored</p></li>
<li><p>-1 = Artefact / Movement</p></li>
<li><p>0 = Wake</p></li>
<li><p>1 = N1 sleep</p></li>
<li><p>2 = N2 sleep</p></li>
<li><p>3 = N3 sleep</p></li>
<li><p>4 = REM sleep</p></li>
</ul>
</div>
</dd>
<dt><strong>include</strong><span class="classifier">tuple, list or int</span></dt><dd><p>Values in <code class="docutils literal notranslate"><span class="pre">hypno</span></code> that will be included in the mask. The default is
(1, 2, 3), meaning that the detection is applied on N1, N2 and N3
sleep. This has no effect when <code class="docutils literal notranslate"><span class="pre">hypno</span></code> is None.</p>
</dd>
<dt><strong>freq_sp</strong><span class="classifier">tuple or list</span></dt><dd><p>Spindles frequency range. Default is 12 to 15 Hz. Please note that YASA
uses a FIR filter (implemented in MNE) with a 1.5Hz transition band,
which means that for <cite>freq_sp = (12, 15 Hz)</cite>, the -6 dB points are
located at 11.25 and 15.75 Hz.</p>
</dd>
<dt><strong>freq_broad</strong><span class="classifier">tuple or list</span></dt><dd><p>Broad band frequency range. Default is 1 to 30 Hz.</p>
</dd>
<dt><strong>duration</strong><span class="classifier">tuple or list</span></dt><dd><p>The minimum and maximum duration of the spindles.
Default is 0.5 to 2 seconds.</p>
</dd>
<dt><strong>min_distance</strong><span class="classifier">int</span></dt><dd><p>If two spindles are closer than <code class="docutils literal notranslate"><span class="pre">min_distance</span></code> (in ms), they are
merged into a single spindles. Default is 500 ms.</p>
</dd>
<dt><strong>thresh</strong><span class="classifier">dict</span></dt><dd><p>Detection thresholds:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'rel_pow'</span></code>: Relative power (= power ratio freq_sp / freq_broad).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'corr'</span></code>: Moving correlation between original signal and
sigma-filtered signal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'rms'</span></code>: Number of standard deviations above the mean of a moving
root mean square of sigma-filtered signal.</p></li>
</ul>
<p>You can disable one or more threshold by putting <code class="docutils literal notranslate"><span class="pre">None</span></code> instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">thresh</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rel_pow&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">:</span> <span class="mf">0.65</span><span class="p">,</span> <span class="s1">&#39;rms&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">}</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rel_pow&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;rms&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><strong>multi_only</strong><span class="classifier">boolean</span></dt><dd><p>Define the behavior of the multi-channel detection. If True, only
spindles that are present on at least two channels are kept. If False,
no selection is applied and the output is just a concatenation of the
single-channel detection dataframe. Default is False.</p>
</dd>
<dt><strong>remove_outliers</strong><span class="classifier">boolean</span></dt><dd><p>If True, YASA will automatically detect and remove outliers spindles
using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html#sklearn.ensemble.IsolationForest" title="(in scikit-learn v1.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.ensemble.IsolationForest</span></code></a>.
The outliers detection is performed on all the spindles
parameters with the exception of the <code class="docutils literal notranslate"><span class="pre">Start</span></code>, <code class="docutils literal notranslate"><span class="pre">Peak</span></code>, <code class="docutils literal notranslate"><span class="pre">End</span></code>,
<code class="docutils literal notranslate"><span class="pre">Stage</span></code>, and <code class="docutils literal notranslate"><span class="pre">SOPhase</span></code> columns.
YASA uses a random seed (42) to ensure reproducible results.
Note that this step will only be applied if there are more than 50
detected spindles in the first place. Default to False.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool or str</span></dt><dd><p>Verbose level. Default (False) will only print warning and error
messages. The logging levels are ‘debug’, ‘info’, ‘warning’, ‘error’,
and ‘critical’. For most users the choice is between ‘info’
(or <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code>) and warning (<code class="docutils literal notranslate"><span class="pre">verbose=False</span></code>).</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.2.0.</span></p>
</div>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><strong>sp</strong><span class="classifier"><a class="reference internal" href="yasa.SpindlesResults.html#yasa.SpindlesResults" title="yasa.SpindlesResults"><code class="xref py py-class docutils literal notranslate"><span class="pre">yasa.SpindlesResults</span></code></a></span></dt><dd><p>To get the full detection dataframe, use:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sp</span> <span class="o">=</span> <span class="n">spindles_detect</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sp</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<p>This will give a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> where each row is a
detected spindle and each column is a parameter (= feature or property)
of this spindle. To get the average spindles parameters per channel and
sleep stage:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sp</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">grp_chan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grp_stage</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The parameters that are calculated for each spindle are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'Start'</span></code>: Start time of the spindle, in seconds from the beginning of
data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Peak'</span></code>: Time at the most prominent spindle peak (in seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'End'</span></code> : End time (in seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Duration'</span></code>: Duration (in seconds)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Amplitude'</span></code>: Peak-to-peak amplitude of the (detrended) spindle in
the raw data (in µV).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'RMS'</span></code>: Root-mean-square (in µV)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'AbsPower'</span></code>: Median absolute power (in log10 µV^2),
calculated from the Hilbert-transform of the <code class="docutils literal notranslate"><span class="pre">freq_sp</span></code> filtered signal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'RelPower'</span></code>: Median relative power of the <code class="docutils literal notranslate"><span class="pre">freq_sp</span></code> band in spindle
calculated from a short-term fourier transform and expressed as a
proportion of the total power in <code class="docutils literal notranslate"><span class="pre">freq_broad</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Frequency'</span></code>: Median instantaneous frequency of spindle (in Hz),
derived from an Hilbert transform of the <code class="docutils literal notranslate"><span class="pre">freq_sp</span></code> filtered signal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Oscillations'</span></code>: Number of oscillations (= number of positive peaks
in spindle.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Symmetry'</span></code>: Location of the most prominent peak of spindle,
normalized from 0 (start) to 1 (end). Ideally this value should be close
to 0.5, indicating that the most prominent peak is halfway through the
spindle.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'Stage'</span></code> : Sleep stage during which spindle occured, if <code class="docutils literal notranslate"><span class="pre">hypno</span></code>
was provided.</p>
<p>All parameters are calculated from the broadband-filtered EEG
(frequency range defined in <code class="docutils literal notranslate"><span class="pre">freq_broad</span></code>).</p>
</li>
</ul>
<p>For better results, apply this detection only on artefact-free NREM sleep.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A critical bug was fixed in YASA 0.6.1, in which the number of detected spindles could
vary drastically depending on the sampling frequency of the data. Please make sure to check
any results obtained with this function prior to the 0.6.1 release.</p>
</div>
<p class="rubric">References</p>
<p>The sleep spindles detection algorithm is based on:</p>
<ul class="simple">
<li><p>Lacourse, K., Delfrate, J., Beaudry, J., Peppard, P., &amp; Warby, S. C.
(2018). <a class="reference external" href="https://doi.org/10.1016/j.jneumeth.2018.08.014">A sleep spindle detection algorithm that emulates human expert
spindle scoring.</a>
Journal of Neuroscience Methods.</p></li>
</ul>
<p class="rubric">Examples</p>
<p>For a walkthrough of the spindles detection, please refer to the following
Jupyter notebooks:</p>
<p><a class="reference external" href="https://github.com/raphaelvallat/yasa/blob/master/notebooks/01_spindles_detection.ipynb">https://github.com/raphaelvallat/yasa/blob/master/notebooks/01_spindles_detection.ipynb</a></p>
<p><a class="reference external" href="https://github.com/raphaelvallat/yasa/blob/master/notebooks/02_spindles_detection_multi.ipynb">https://github.com/raphaelvallat/yasa/blob/master/notebooks/02_spindles_detection_multi.ipynb</a></p>
<p><a class="reference external" href="https://github.com/raphaelvallat/yasa/blob/master/notebooks/03_spindles_detection_NREM_only.ipynb">https://github.com/raphaelvallat/yasa/blob/master/notebooks/03_spindles_detection_NREM_only.ipynb</a></p>
<p><a class="reference external" href="https://github.com/raphaelvallat/yasa/blob/master/notebooks/04_spindles_slow_fast.ipynb">https://github.com/raphaelvallat/yasa/blob/master/notebooks/04_spindles_slow_fast.ipynb</a></p>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018-2022, Dr. Raphael Vallat, Center for Human Sleep Science, UC Berkeley.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>